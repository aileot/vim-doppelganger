let g:repo_root = fnamemodify(expand('<sfile>'), ':p:h:h')

call themis#option('recursive', 1)
call themis#option('exclude', ['test/_testdata/'])

let s:helper = themis#helper('assert')
call themis#helper('command').with(s:helper)

function! GetVirtualTexts() abort
  " Return a Dict in the format, {lnum : virt_text}

  let virt_texts = {}

  const namespace = nvim_get_namespaces().doppelganger
  const marks = nvim_buf_get_extmarks(0, namespace, 0, -1, {'details': 1})
  for m in marks
    let lnum = m[1] + 1
    let info = m[3].virt_text
    call extend(virt_texts, {lnum : map(info, 'v:val[0]')})
  endfor

  return virt_texts
endfunction
