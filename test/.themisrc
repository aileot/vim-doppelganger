let g:repo_root = fnamemodify(expand('<sfile>'), ':p:h:h')

call themis#option('recursive', 1)
call themis#option('exclude', ['test/_testdata/'])

let s:helper = themis#helper('assert')
call themis#helper('command').with(s:helper)

function! GetVirtualTextsAsPlainTexts() abort
  " Return a Dict in the format, {lnum : virt_text}

  let virt_texts = {}

  const ns = nvim_get_namespaces().doppelganger
  const extmarks = nvim_buf_get_extmarks(0, ns, 0, -1, {'details': 1})
  for m in extmarks
    let info = m[3]
    let chunks = get(info, 'virt_text', [])
    let texts = map(deepcopy(chunks), 'len(v:val) == 2 ? v:val[0] : ""')
    let lnum = m[1] + 1
    call extend(virt_texts, {lnum : join(texts, '')})
  endfor

  return virt_texts
endfunction
